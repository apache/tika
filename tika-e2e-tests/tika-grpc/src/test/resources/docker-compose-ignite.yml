version: '3.8'

services:
  # Tika gRPC server with embedded Ignite server
  tika-grpc:
    image: apache/tika-grpc:local
    ports:
      - "50052:50052"
    volumes:
      - ${HOST_GOVDOCS1_DIR}:/tika/govdocs1:ro
      - ./tika-config-ignite.json:/config/tika-config.json:ro
    command: ["-c", "/config/tika-config.json"]
    environment:
      - JAVA_OPTS=-Xmx2g -XX:+UseG1GC
    networks:
      - tika-cluster
    healthcheck:
      test: ["CMD", "grpc_health_probe", "-addr=:50052"]
      interval: 10s
      timeout: 5s
      retries: 3

networks:
  tika-cluster:
    driver: bridge
